# Руководство по использованию

## Подготовка входного файла

Входной файл должен быть в формате JSON и содержать массив сообщений. Каждое сообщение должно иметь уникальный идентификатор и текст с информацией об операциях.

### Формат входного файла

```json
{
  "messages": [
    {
      "id": 1,
      "payload": "Пахота зяби под мн тр\nПо Пу 26/488\nОтд 12 26/221"
    },
    {
      "id": 2,
      "payload": "Предп культ под оз пш\nПо Пу 215/1015\nОтд 12 128/317"
    }
  ]
}
```

### Правила составления сообщений

1. **Операции**:
   - Указывайте тип операции в начале строки
   - Используйте стандартные названия операций (см. [список операций](../api/reference-data.md#операции))
   - Разделяйте разные операции переносом строки

2. **Культуры**:
   - Указывайте культуру после слова "под"
   - Используйте стандартные названия культур (см. [список культур](../api/reference-data.md#культуры))
   - Допускаются сокращения (например, "оз пш" вместо "озимая пшеница")

3. **Площади**:
   - Формат: "По Пу X/Y", где X - дневная площадь, Y - общая площадь
   - Числа должны быть целыми
   - Разделитель - косая черта (/)

4. **Подразделения**:
   - Формат: "Отд X Y/Z", где X - номер отдела, Y - дневная площадь, Z - общая площадь
   - Номер отдела должен быть числом от 1 до 20

## Обработка данных

### Запуск обработки

```bash
python main.py input.json [options]
```

Параметры:
- `input.json` - путь к входному файлу (обязательный)
- `-v, --verbose` - включить подробный вывод логов
- `-o, --output` - указать путь для сохранения результатов

Примеры:
```bash
# Базовая обработка
python main.py input.json

# С подробным выводом
python main.py input.json -v

# С указанием выходного файла
python main.py input.json -o results.json
```

### Процесс обработки

1. **Загрузка данных**:
   - Проверка формата входного файла
   - Валидация структуры данных
   - Подготовка сообщений к обработке

2. **Парсинг**:
   - Разделение текста на блоки операций
   - Извлечение информации об операциях
   - Парсинг числовых значений
   - Определение подразделений

3. **Валидация**:
   - Проверка операций по справочнику
   - Валидация культур
   - Проверка числовых значений
   - Корректировка опечаток

4. **Обработка ошибок**:
   - Заполнение пропущенных полей
   - Корректировка некорректных значений
   - Логирование проблем

## Результаты обработки

### Формат выходного файла

```json
{
  "reports": [
    {
      "message_number": 1,
      "payload": "Пахота зяби под мн тр\nПо Пу 26/488\nОтд 12 26/221",
      "parsed": [
        {
          "date": null,
          "division": "АОР",
          "operation": "Пахота",
          "crop": "Многолетние травы",
          "dailyArea": 26,
          "totalArea": 488,
          "dailyYield": null,
          "totalYield": null
        }
      ]
    }
  ]
}
```

### Поля выходных данных

- `message_number` - номер исходного сообщения
- `payload` - оригинальный текст сообщения
- `parsed` - массив извлеченных операций, где каждая операция содержит:
  - `date` - дата операции (если указана)
  - `division` - подразделение
  - `operation` - тип операции
  - `crop` - культура
  - `dailyArea` - дневная площадь
  - `totalArea` - общая площадь
  - `dailyYield` - дневная урожайность (если указана)
  - `totalYield` - общая урожайность (если указана)

### Расположение выходного файла

По умолчанию результаты сохраняются в файл `output.json` в текущей директории. Вы можете изменить путь к выходному файлу с помощью параметра `-o`:

```bash
python main.py input.json -o results.json
```

### Логи обработки

Дополнительная информация о процессе обработки сохраняется в:
- `app.log` - основной файл логов
- Консольный вывод (при использовании `-v`)

В логах вы найдете:
- Количество обработанных сообщений
- Предупреждения о некорректных данных
- Статистику по пропущенным полям
- Время выполнения операций 