# Agricultural Data Processing Application

Приложение для обработки и анализа сельскохозяйственных данных из неструктурированных текстовых сообщений.

## Структура проекта

```
.
├── config/                 # Конфигурационные файлы
│   ├── __init__.py
│   └── reference_data.py   # Справочные данные для валидации
├── utils/                  # Утилиты для обработки данных
│   ├── __init__.py
│   ├── input_processor.py  # Загрузка и подготовка входных данных
│   ├── text_parser.py      # Парсинг текстовых сообщений
│   └── validator.py        # Валидация извлеченных данных
├── tests/                  # Тесты
│   ├── input.json         # Пример входных данных
│   ├── expected_output.json # Пример ожидаемых результатов
│   └── test_full_pipeline.py # Тесты полного пайплайна
├── main.py                # Основной скрипт приложения
└── README.md              # Документация
```

## Установка и запуск

1. Убедитесь, что у вас установлен Python 3.8 или выше
2. Клонируйте репозиторий
3. Установите зависимости:
```bash
pip install -r requirements.txt
```

## Запуск приложения

### Основной режим работы

```bash
python main.py <input_file> [options]
```

Параметры:
- `input_file` - путь к JSON-файлу с входными данными
- `-v, --verbose` - включить подробный вывод логов
- `-o, --output` - указать путь для сохранения результатов (по умолчанию: output.json)

Пример:
```bash
python main.py tests/input.json -v -o results.json
```

### Запуск тестов

```bash
python -m unittest discover tests -v
```

## Форматы данных

### Входные данные (input.json)

```json
{
  "messages": [
    {
      "id": 1,
      "payload": "Пахота зяби под мн тр\nПо Пу 26/488\nОтд 12 26/221"
    },
    {
      "id": 2,
      "payload": "Предп культ под оз пш\nПо Пу 215/1015\nОтд 12 128/317"
    }
  ]
}
```

### Выходные данные (output.json)

```json
{
  "reports": [
    {
      "message_number": 1,
      "payload": "Пахота зяби под мн тр\nПо Пу 26/488\nОтд 12 26/221",
      "parsed": [
        {
          "date": null,
          "division": "АОР",
          "operation": "Пахота",
          "crop": "Многолетние травы",
          "dailyArea": 26,
          "totalArea": 488,
          "dailyYield": null,
          "totalYield": null
        }
      ]
    }
  ]
}
```

## Анализ данных

Приложение выполняет следующие этапы обработки данных:

1. **Загрузка данных**
   - Чтение JSON-файла с входными данными
   - Валидация структуры входного файла

2. **Парсинг сообщений**
   - Разделение текста на блоки операций
   - Извлечение дат, подразделений, операций и культур
   - Парсинг числовых значений (площади, урожайность)

3. **Валидация данных**
   - Проверка операций по справочнику
   - Проверка культур по справочнику
   - Валидация числовых значений
   - Исправление опечаток и вариаций в названиях

4. **Обработка ошибок**
   - Заполнение пропущенных полей
   - Корректировка некорректных значений
   - Логирование предупреждений и ошибок

## Поддерживаемые операции

- Пахота
- Дискование
- Чизелевание
- Предпосевная культивация
- Сев
- Уборка
- Внесение удобрений
- Подкормка
- Боронование
- Гербицидная обработка
- Прикатывание

## Поддерживаемые культуры

- Пшеница озимая
- Ячмень озимый
- Свекла сахарная
- Подсолнечник
- Соя
- Кукуруза
- Рапс озимый
- Многолетние травы
- Овес

## Логирование

Приложение ведет подробный лог обработки данных, включая:
- Количество обработанных сообщений
- Количество извлеченных операций
- Предупреждения о некорректных данных
- Статистику по пропущенным полям
- Время выполнения операций

## Обработка ошибок

Приложение обрабатывает следующие типы ошибок:
- Некорректный формат входного файла
- Отсутствие обязательных полей
- Нераспознанные операции и культуры
- Некорректные числовые значения
- Пропущенные даты и подразделения

## Примеры использования

1. Обработка тестовых данных:
```bash
python main.py tests/input.json -v
```

2. Сохранение результатов в указанный файл:
```bash
python main.py input.json -o results.json
```

3. Запуск тестов:
```bash
python -m unittest discover tests -v
```

