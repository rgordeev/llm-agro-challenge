# Обработчик сельскохозяйственных данных

## Назначение проекта

Приложение предназначено для обработки неструктурированных текстовых данных о сельскохозяйственных операциях. Оно преобразует текстовые сообщения в структурированный формат JSON, извлекая информацию о:
- Типах операций (пахота, боронование и т.д.)
- Культурах
- Подразделениях и отделах
- Площадях (дневной и общей)
- Датах проведения работ

## Установка

1. Клонируйте репозиторий:
```bash
git clone https://github.com/yourusername/agricultural-data-processor.git
cd agricultural-data-processor
```

2. Дополнительная установка не требуется, так как приложение использует только стандартную библиотеку Python.

## Использование

### Базовое использование
```bash
python main.py input.json [--output output.json] [-v]
```

Параметры:
- `input.json` - входной файл с сообщениями (обязательный)
- `--output output.json` - путь для сохранения результатов (по умолчанию: output.json)
- `-v` или `--verbose` - включение подробного логирования

### Пример входного файла (input.json)
```json
{
  "messages": [
    {
      "id": 1,
      "date": "2025-04-12",
      "payload": "Пахота зяби под мн тр\nПо Пу 26/488\nОтд 12 26/221"
    }
  ]
}
```

### Пример выходного файла (output.json)
```json
{
  "reports": [
    {
      "message_number": 1,
      "payload": "Пахота зяби под мн тр\nПо Пу 26/488\nОтд 12 26/221",
      "parsed": [
        {
          "date": "12.04",
          "division": "АОР",
          "operation": "Пахота зяби",
          "crop": "Многолетние травы",
          "dailyArea": 26,
          "totalArea": 221
        }
      ]
    }
  ]
}
```

## Как это работает

Приложение обрабатывает данные в несколько этапов:

1. **Загрузка данных**
   - Чтение входного JSON файла
   - Валидация структуры входных данных
   - Подготовка сообщений к обработке

2. **Парсинг текста**
   - Разделение на блоки операций
   - Извлечение основной информации (операции, культуры)
   - Обработка метрик (площади, даты)
   - Определение подразделений и отделов

3. **Валидация данных**
   - Проверка операций по справочнику
   - Валидация культур
   - Проверка подразделений
   - Коррекция опечаток и сокращений

4. **Обработка ошибок**
   - Заполнение пропущенных полей
   - Логирование предупреждений
   - Обработка несовместимых данных

5. **Формирование результата**
   - Структурирование данных
   - Сохранение в JSON формат

## Структура проекта

```
agricultural_data_processor/
│
├── main.py                  # Точка входа
├── config/
│   ├── __init__.py
│   └── reference_data.py    # Справочные данные
│
├── utils/
│   ├── __init__.py
│   ├── input_processor.py   # Обработка входных данных
│   ├── text_parser.py       # Парсинг текста
│   └── validator.py         # Валидация данных
│
└── tests/
    ├── __init__.py
    ├── test_data.json      # Тестовые данные
    └── test_parser.py      # Тесты
```

## Расширение функциональности

### Добавление новых операций
1. Добавьте операцию в `VALID_OPERATIONS` в `config/reference_data.py`
2. При необходимости добавьте сокращения в `OPERATION_CORRECTIONS`

### Добавление новых культур
1. Добавьте культуру в `VALID_CROPS` в `config/reference_data.py`
2. Добавьте сокращения в `CROP_ABBREVIATIONS`

### Добавление новых подразделений
1. Обновите структуру `DIVISIONS` в `config/reference_data.py`
2. При необходимости обновите функции `get_division_from_department`

### Улучшение парсинга
1. Добавьте новые регулярные выражения в `utils/text_parser.py`
2. Расширьте функции извлечения данных
3. Добавьте обработку новых форматов

## Логирование

Приложение использует стандартный модуль `logging` с двумя обработчиками:
- Консольный вывод (все сообщения уровня INFO и выше)
- Файловый вывод в `app.log` (все сообщения уровня DEBUG и выше)

## Обработка ошибок

Приложение обрабатывает следующие типы ошибок:
- Некорректный формат входных данных
- Неизвестные операции и культуры
- Несовместимые комбинации операций и культур
- Некорректные даты и метрики
- Отсутствующие обязательные поля

## Требования

- Python 3.7 или выше
- Не требует дополнительных библиотек

## Лицензия

MIT License

